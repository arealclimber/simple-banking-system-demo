<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="120" alt="Nest Logo" /></a>
</p>

[circleci-image]: https://img.shields.io/circleci/build/github/nestjs/nest/master?token=abc123def456
[circleci-url]: https://circleci.com/gh/nestjs/nest

  <p align="center">A progressive <a href="http://nodejs.org" target="_blank">Node.js</a> framework for building efficient and scalable server-side applications.</p>
    <p align="center">
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/v/@nestjs/core.svg" alt="NPM Version" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/l/@nestjs/core.svg" alt="Package License" /></a>
<a href="https://www.npmjs.com/~nestjscore" target="_blank"><img src="https://img.shields.io/npm/dm/@nestjs/common.svg" alt="NPM Downloads" /></a>
<a href="https://circleci.com/gh/nestjs/nest" target="_blank"><img src="https://img.shields.io/circleci/build/github/nestjs/nest/master" alt="CircleCI" /></a>
<a href="https://discord.gg/G7Qnnhy" target="_blank"><img src="https://img.shields.io/badge/discord-online-brightgreen.svg" alt="Discord"/></a>
<a href="https://opencollective.com/nest#backer" target="_blank"><img src="https://opencollective.com/nest/backers/badge.svg" alt="Backers on Open Collective" /></a>
<a href="https://opencollective.com/nest#sponsor" target="_blank"><img src="https://opencollective.com/nest/sponsors/badge.svg" alt="Sponsors on Open Collective" /></a>
  <a href="https://paypal.me/kamilmysliwiec" target="_blank"><img src="https://img.shields.io/badge/Donate-PayPal-ff3f59.svg" alt="Donate us"/></a>
    <a href="https://opencollective.com/nest#sponsor"  target="_blank"><img src="https://img.shields.io/badge/Support%20us-Open%20Collective-41B883.svg" alt="Support us"></a>
  <a href="https://twitter.com/nestframework" target="_blank"><img src="https://img.shields.io/twitter/follow/nestframework.svg?style=social&label=Follow" alt="Follow us on Twitter"></a>
</p>
  <!--[![Backers on Open Collective](https://opencollective.com/nest/backers/badge.svg)](https://opencollective.com/nest#backer)
  [![Sponsors on Open Collective](https://opencollective.com/nest/sponsors/badge.svg)](https://opencollective.com/nest#sponsor)-->

## Description

[Nest](https://github.com/nestjs/nest) framework TypeScript starter repository.

## Project setup

```bash
$ npm install
```

## Compile and run the project

```bash
# development
$ npm run start

# watch mode
$ npm run start:dev

# production mode
$ npm run start:prod
```

## Run tests

```bash
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Deployment

When you're ready to deploy your NestJS application to production, there are some key steps you can take to ensure it runs as efficiently as possible. Check out the [deployment documentation](https://docs.nestjs.com/deployment) for more information.

If you are looking for a cloud-based platform to deploy your NestJS application, check out [Mau](https://mau.nestjs.com), our official platform for deploying NestJS applications on AWS. Mau makes deployment straightforward and fast, requiring just a few simple steps:

```bash
$ npm install -g @nestjs/mau
$ mau deploy
```

With Mau, you can deploy your application in just a few clicks, allowing you to focus on building features rather than managing infrastructure.

## Resources

Check out a few resources that may come in handy when working with NestJS:

- Visit the [NestJS Documentation](https://docs.nestjs.com) to learn more about the framework.
- For questions and support, please visit our [Discord channel](https://discord.gg/G7Qnnhy).
- To dive deeper and get more hands-on experience, check out our official video [courses](https://courses.nestjs.com/).
- Deploy your application to AWS with the help of [NestJS Mau](https://mau.nestjs.com) in just a few clicks.
- Visualize your application graph and interact with the NestJS application in real-time using [NestJS Devtools](https://devtools.nestjs.com).
- Need help with your project (part-time to full-time)? Check out our official [enterprise support](https://enterprise.nestjs.com).
- To stay in the loop and get updates, follow us on [X](https://x.com/nestframework) and [LinkedIn](https://linkedin.com/company/nestjs).
- Looking for a job, or have a job to offer? Check out our official [Jobs board](https://jobs.nestjs.com).

## Support

Nest is an MIT-licensed open source project. It can grow thanks to the sponsors and support by the amazing backers. If you'd like to join them, please [read more here](https://docs.nestjs.com/support).

## Stay in touch

- Author - [Kamil MyÅ›liwiec](https://twitter.com/kammysliwiec)
- Website - [https://nestjs.com](https://nestjs.com/)
- Twitter - [@nestframework](https://twitter.com/nestframework)

## License

Nest is [MIT licensed](https://github.com/nestjs/nest/blob/master/LICENSE).

# éŠ€è¡Œç³»çµ± API

ä¸€å€‹ä½¿ç”¨ NestJS å’Œäº‹ä»¶æºæ¶æ§‹å¯¦ç¾çš„ç°¡å–®éŠ€è¡Œç³»çµ±ï¼Œæ”¯æŒå¸³æˆ¶ç®¡ç†ã€äº¤æ˜“æ“ä½œå’Œå®Œæ•´çš„äº¤æ˜“è¨˜éŒ„è¿½è¹¤ã€‚

## ğŸ¯ é¢è©¦å±•ç¤ºï¼šäº¤æ˜“è¨˜éŒ„åŠŸèƒ½

### âš¡ 5 åˆ†é˜å¿«é€Ÿé©—è­‰

**æ­¥é©Ÿ 1: ä¸€éµåŠŸèƒ½æ¼”ç¤º**

```bash
npm install
npm run demo
```

é€™æœƒè‡ªå‹•å±•ç¤ºæ‰€æœ‰äº¤æ˜“è¨˜éŒ„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

- âœ… å‰µå»ºå¸³æˆ¶ä¸¦åŸ·è¡Œå„ç¨®äº¤æ˜“
- âœ… æŸ¥è©¢äº¤æ˜“è¨˜éŒ„ï¼ˆåŒ…å« whenã€amountã€toAccountIdï¼‰
- âœ… æ¸¬è©¦ limit å’Œ since æŸ¥è©¢åƒæ•¸
- âœ… é©—è­‰å†ªç­‰æ€§ä¿è­‰

**æ­¥é©Ÿ 2: æ¸¬è©¦è¦†è“‹é©—è­‰**

```bash
# äº¤æ˜“è¨˜éŒ„ç«¯å°ç«¯æ¸¬è©¦ï¼ˆ6å€‹å ´æ™¯ï¼‰
npm run test:e2e -- --testPathPattern=transaction-log.e2e-spec.ts

# äº¤æ˜“è¨˜éŒ„å–®å…ƒæ¸¬è©¦ï¼ˆ3å€‹å ´æ™¯ï¼Œå°ˆæ³¨å†ªç­‰æ€§ï¼‰
npm run test -- --testPathPattern=transaction-history.projector.spec.ts
```

**æ­¥é©Ÿ 3: API æ–‡æª”æŸ¥çœ‹**

```bash
npm run start:dev
# è¨ªå• http://localhost:3000/api
# æŸ¥çœ‹ GET /accounts/{id}/transactions ç«¯é»
```

### ğŸ“Š é¡Œç›®è¦æ±‚å®Œæ•´å°ç…§

| é¢è©¦è¦æ±‚                         | å¯¦ç¾ä½ç½®                    | é©—è­‰æ–¹æ³•                  |
| -------------------------------- | --------------------------- | ------------------------- |
| **Transaction log per transfer** | TransactionHistoryProjector | æ¼”ç¤ºè…³æœ¬å±•ç¤ºè½‰å¸³è¨˜éŒ„      |
| **when (æ™‚é–“æˆ³)**                | LogEntry.occurredAt         | API éŸ¿æ‡‰åŒ…å«æ¯«ç§’æ™‚é–“æˆ³    |
| **amount (é‡‘é¡)**                | LogEntry.amount             | API éŸ¿æ‡‰åŒ…å«ç²¾ç¢ºé‡‘é¡      |
| **to-what-account (ç›®æ¨™å¸³æˆ¶)**   | LogEntry.toAccountId        | API éŸ¿æ‡‰åŒ…å«ç›®æ¨™å¸³æˆ¶ UUID |

### ğŸ—ï¸ æŠ€è¡“äº®é»

**äº‹ä»¶æº + CQRS æ¶æ§‹ï¼š**

- å®Œæ•´å¯©è¨ˆè»Œè·¡ï¼Œæ”¯æŒäº‹ä»¶é‡æ’­
- è®€å¯«åˆ†é›¢å„ªåŒ–æŸ¥è©¢æ€§èƒ½
- ç¢ºå®šæ€§ ID ä¿è­‰å†ªç­‰æ€§

**å‘½åçµ±ä¸€å„ªåŒ–ï¼š**

- è§£æ±ºäº†äº‹ä»¶é¡åèˆ‡äº‹ä»¶é¡å‹ä¸ä¸€è‡´å•é¡Œ
- ä½¿ç”¨ TypeScript æšèˆ‰æ›¿ä»£é­”æ³•å­—ç¬¦ä¸²
- æé«˜ä»£ç¢¼å¯ç¶­è­·æ€§å’Œ IDE æ”¯æ´

**è©³ç´°æ–‡æª”ï¼š**

- ğŸ“– [å®Œæ•´é©—è­‰æŒ‡å—](docs/transaction-log-verification.md)
- ğŸ“– [é¢è©¦å±•ç¤ºæ‘˜è¦](docs/interview-demo-summary.md)
- ğŸ“– [äº‹ä»¶å‘½åè¦ç¯„](docs/event-naming-convention.md)

---

# ç°¡æ˜“éŠ€è¡Œç³»çµ±

ä½¿ç”¨é ˜åŸŸé©…å‹•è¨­è¨ˆå’Œäº‹ä»¶æºæ¨¡å¼å¯¦ç¾çš„ç°¡æ˜“éŠ€è¡Œç³»çµ± APIã€‚

## åŠŸèƒ½ç‰¹é»

- åŸºæ–¼ NestJS æ¡†æ¶çš„ RESTful API
- æ¡ç”¨é ˜åŸŸé©…å‹•è¨­è¨ˆ (DDD) å’Œäº‹ä»¶æº (Event Sourcing) æ¶æ§‹
- æä¾›å¸³æˆ¶å‰µå»ºã€å­˜æ¬¾ã€å–æ¬¾å’Œè½‰å¸³ç­‰åŸºæœ¬éŠ€è¡Œæ“ä½œ
- ç¢ºä¿å¸³æˆ¶é¤˜é¡ä¸èƒ½ç‚ºè² æ•¸
- ç”Ÿæˆå¸³æˆ¶äº¤æ˜“æ—¥èªŒ
- æ”¯æŒåŸå­äº¤æ˜“ï¼ˆä½¿ç”¨åŸºæ–¼äº’æ–¥é–çš„ä¸¦ç™¼æ§åˆ¶ï¼‰
- å–®å…ƒæ¸¬è©¦å’Œç«¯å°ç«¯æ¸¬è©¦

## API æ–‡æª”

å•Ÿå‹•æœå‹™å™¨å¾Œï¼Œæ‚¨å¯ä»¥åœ¨ç€è¦½å™¨ä¸­è¨ªå• [http://localhost:3000/api](http://localhost:3000/api) æŸ¥çœ‹ Swagger UI æ–‡æª”ã€‚

## API è«‹æ±‚ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä½¿ç”¨ `curl` å‘½ä»¤çš„ API è«‹æ±‚ç¤ºä¾‹ï¼š

### å‰µå»ºå¸³æˆ¶

```bash
curl -X POST http://localhost:3000/accounts \
  -H "Content-Type: application/json" \
  -d '{
    "name": "å¼µä¸‰çš„å¸³æˆ¶",
    "initialBalance": {
      "amount": 1000
    }
  }'
```

### å­˜æ¬¾

```bash
curl -X POST http://localhost:3000/accounts/{å¸³æˆ¶ID}/deposit \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 500
  }'
```

### å–æ¬¾

```bash
curl -X POST http://localhost:3000/accounts/{å¸³æˆ¶ID}/withdraw \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 200
  }'
```

### è½‰å¸³

```bash
curl -X POST http://localhost:3000/accounts/{ä¾†æºå¸³æˆ¶ID}/transfer \
  -H "Content-Type: application/json" \
  -d '{
    "destinationAccountId": "{ç›®æ¨™å¸³æˆ¶ID}",
    "amount": {
      "amount": 300
    }
  }'
```

### æŸ¥è©¢é¤˜é¡

```bash
curl -X GET http://localhost:3000/accounts/{å¸³æˆ¶ID}/balance
```

### æŸ¥è©¢æ‰€æœ‰å¸³æˆ¶

```bash
curl -X GET http://localhost:3000/accounts
```

## å®‰è£èˆ‡åŸ·è¡Œ

### å®‰è£ä¾è³´

```bash
npm install
```

### é‹è¡Œé–‹ç™¼æœå‹™å™¨

```bash
npm run start:dev
```

### é‹è¡Œæ¸¬è©¦

```bash
# å–®å…ƒæ¸¬è©¦
npm run test

# e2e æ¸¬è©¦
npm run test:e2e

# æ¸¬è©¦è¦†è“‹ç‡
npm run test:cov
```

### æ§‹å»ºç”Ÿç”¢ç‰ˆæœ¬

```bash
npm run build
```

## Docker éƒ¨ç½²

æœ¬å°ˆæ¡ˆæä¾›å®Œæ•´çš„ Docker æ”¯æŒï¼Œé©ç”¨æ–¼é–‹ç™¼å’Œç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²ã€‚

### æ§‹å»º Docker é¡åƒ

```bash
# æ§‹å»ºé¡åƒ
docker build -t banking-api:latest .

# æŸ¥çœ‹æ§‹å»ºçš„é¡åƒ
docker images banking-api
```

### é‹è¡Œ Docker å®¹å™¨

```bash
# åœ¨å¾Œå°é‹è¡Œå®¹å™¨ï¼Œæ˜ å°„åˆ°ç«¯å£ 3000
docker run -d -p 3000:3000 --name banking-api banking-api:latest

# æŸ¥çœ‹é‹è¡Œç‹€æ…‹
docker ps

# æŸ¥çœ‹æ‡‰ç”¨æ—¥èªŒ
docker logs banking-api
```

### æ¸¬è©¦ Docker éƒ¨ç½²

```bash
# æ¸¬è©¦å¥åº·æª¢æŸ¥ç«¯é»
curl http://localhost:3000/health

# é æœŸå›æ‡‰: {"status":"OK"}

# æ¸¬è©¦ API æ–‡æª”
# ç€è¦½å™¨è¨ªå•: http://localhost:3000/api
```

### åœæ­¢å’Œæ¸…ç†å®¹å™¨

```bash
# åœæ­¢å®¹å™¨
docker stop banking-api

# ç§»é™¤å®¹å™¨
docker rm banking-api

# ç§»é™¤é¡åƒï¼ˆå¯é¸ï¼‰
docker rmi banking-api:latest
```

### Docker æœ€ä½³å¯¦è¸èªªæ˜

æœ¬å°ˆæ¡ˆçš„ Dockerfile æ¡ç”¨ä»¥ä¸‹æœ€ä½³å¯¦è¸ï¼š

1. **å¤šéšæ®µæ§‹å»º**ï¼šåˆ†é›¢æ§‹å»ºç’°å¢ƒå’Œé‹è¡Œç’°å¢ƒï¼Œæ¸›å°‘æœ€çµ‚é¡åƒå¤§å°
2. **Node.js 20**ï¼šä½¿ç”¨ Node.js 20 ä»¥æ”¯æ´ NestJS 11+ çš„å¼•æ“è¦æ±‚
3. **ç”Ÿç”¢ä¾è³´å„ªåŒ–**ï¼šä½¿ç”¨ `--omit=dev --ignore-scripts` åƒæ•¸ï¼š

   - `--omit=dev`: åªå®‰è£ç”Ÿç”¢ä¾è³´ï¼Œæ’é™¤é–‹ç™¼å·¥å…·
   - `--ignore-scripts`: è·³é npm è…³æœ¬åŸ·è¡Œï¼Œé¿å…ä»¥ä¸‹å•é¡Œï¼š
     - **Husky å¤±æ•—**ï¼šç”Ÿç”¢å®¹å™¨ç„¡ Git ç’°å¢ƒï¼Œhusky install æœƒå¤±æ•—
     - **å®‰å…¨è€ƒé‡**ï¼šæ¸›å°‘åŸ·è¡Œä¸å¿…è¦è…³æœ¬çš„æ½›åœ¨é¢¨éšª
     - **æ§‹å»ºç©©å®šæ€§**ï¼šé¿å…é–‹ç™¼å·¥å…·ä¾è³´å°è‡´çš„æ§‹å»ºå¤±æ•—
     - **æ€§èƒ½æœ€ä½³åŒ–**ï¼šåŠ å¿«å®¹å™¨å•Ÿå‹•é€Ÿåº¦

4. **æœ€å°åŒ–æ”»æ“Šé¢**ï¼šç”Ÿç”¢å®¹å™¨åªåŒ…å«é‹è¡Œæ‡‰ç”¨çš„å¿…è¦çµ„ä»¶

## Makefile è‡ªå‹•åŒ–æ“ä½œ

æœ¬å°ˆæ¡ˆæä¾› Makefile ä¾†ç°¡åŒ–å¸¸è¦‹çš„é–‹ç™¼å’Œéƒ¨ç½²æ“ä½œï¼Œè®“é–‹ç™¼è€…èƒ½å¤ å¿«é€ŸåŸ·è¡Œå„ç¨®ä»»å‹™ã€‚

### æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤

```bash
make help
```

é€™æœƒé¡¯ç¤ºæ‰€æœ‰å¯ç”¨çš„å‘½ä»¤åŠå…¶èªªæ˜ã€‚

### é–‹ç™¼ç’°å¢ƒ

#### å•Ÿå‹•æœ¬åœ°é–‹ç™¼ç’°å¢ƒ

```bash
# å•Ÿå‹• watch æ¨¡å¼çš„é–‹ç™¼æœå‹™å™¨
make dev

# ç­‰åŒæ–¼: npm run start:dev
```

#### ä½¿ç”¨ Docker å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ

```bash
# æ§‹å»ºé¡åƒä¸¦å•Ÿå‹•é–‹ç™¼å®¹å™¨
make dev-docker

# æœå‹™æœƒåœ¨ http://localhost:3001 å•Ÿå‹•
# API æ–‡æª”: http://localhost:3001/api
# å¥åº·æª¢æŸ¥: http://localhost:3001/health
```

### ç”Ÿç”¢ç’°å¢ƒ

#### ä¸€éµéƒ¨ç½²ç”Ÿç”¢ç’°å¢ƒ

```bash
# æ§‹å»ºé¡åƒä¸¦å•Ÿå‹•ç”Ÿç”¢å®¹å™¨
make prod

# è‡ªå‹•åŸ·è¡Œä»¥ä¸‹æ“ä½œï¼š
# 1. æ§‹å»º Docker é¡åƒ
# 2. åœæ­¢ä¸¦ç§»é™¤ç¾æœ‰å®¹å™¨
# 3. å•Ÿå‹•æ–°çš„ç”Ÿç”¢å®¹å™¨
# 4. ç­‰å¾…æ‡‰ç”¨å•Ÿå‹•
```

#### æ¸¬è©¦ç”Ÿç”¢ç’°å¢ƒ

```bash
# éƒ¨ç½²ä¸¦è‡ªå‹•æ¸¬è©¦ç”Ÿç”¢ç’°å¢ƒ
make test-docker

# æœƒåŸ·è¡Œï¼š
# 1. make prod (æ§‹å»ºä¸¦å•Ÿå‹•)
# 2. æ¸¬è©¦å¥åº·æª¢æŸ¥ç«¯é»
# 3. é¡¯ç¤ºæ¸¬è©¦çµæœ
```

### å»ºæ§‹å’Œç®¡ç†

#### Docker é¡åƒæ“ä½œ

```bash
# æ§‹å»º Docker é¡åƒ
make build

# å¼·åˆ¶é‡æ–°æ§‹å»ºï¼ˆç„¡å¿«å–ï¼‰
make build-no-cache

# æŸ¥çœ‹å®¹å™¨å’Œé¡åƒç‹€æ…‹
make status
```

#### æ¸¬è©¦ç›¸é—œå‘½ä»¤

```bash
# é‹è¡Œå–®å…ƒæ¸¬è©¦
make test

# é‹è¡Œç«¯å°ç«¯æ¸¬è©¦
make test-e2e

# é‹è¡Œä»£ç¢¼æª¢æŸ¥
make lint

# æ ¼å¼åŒ–ä»£ç¢¼
make format
```

### æ¸…ç†å’Œç¶­è­·

#### æ¸…ç†å®¹å™¨

```bash
# åœæ­¢ä¸¦ç§»é™¤å®¹å™¨
make clean

# æ¸…ç†å®¹å™¨å’Œé¡åƒ
make clean-all
```

#### æŸ¥çœ‹ç‹€æ…‹å’Œæ—¥èªŒ

```bash
# æŸ¥çœ‹å®¹å™¨ç‹€æ…‹
make status

# æŸ¥çœ‹å®¹å™¨æ—¥èªŒ
make logs

# å®‰è£ä¾è³´
make install
```

### å¸¸ç”¨å·¥ä½œæµç¨‹ç¤ºä¾‹

#### å®Œæ•´çš„é–‹ç™¼æµç¨‹

```bash
# 1. å®‰è£ä¾è³´
make install

# 2. é‹è¡Œæ¸¬è©¦ç¢ºä¿ä»£ç¢¼æ­£å¸¸
make test

# 3. æª¢æŸ¥ä»£ç¢¼é¢¨æ ¼
make lint

# 4. å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
make dev
```

#### ç”Ÿç”¢éƒ¨ç½²å’Œé©—è­‰

```bash
# 1. æ§‹å»ºä¸¦éƒ¨ç½²ç”Ÿç”¢ç’°å¢ƒ
make prod

# 2. æ¸¬è©¦éƒ¨ç½²æ˜¯å¦æˆåŠŸ
curl http://localhost:3001/health

# 3. æŸ¥çœ‹é‹è¡Œç‹€æ…‹
make status

# 4. æŸ¥çœ‹æ—¥èªŒï¼ˆå¦‚éœ€è¦ï¼‰
make logs

# 5. æ¸…ç†ï¼ˆå®Œæˆå¾Œï¼‰
make clean
```

#### å®Œæ•´çš„ CI/CD æ¨¡æ“¬

```bash
# 1. é‹è¡Œæ‰€æœ‰æ¸¬è©¦
make test && make test-e2e

# 2. æª¢æŸ¥ä»£ç¢¼å“è³ª
make lint

# 3. æ¸¬è©¦ Docker ç”Ÿç”¢ç’°å¢ƒ
make test-docker

# 4. æ¸…ç†ç’°å¢ƒ
make clean-all
```

### ç«¯å£é…ç½®

- **é–‹ç™¼ç’°å¢ƒ**ï¼šhttp://localhost:3001
- **API æ–‡æª”**ï¼šhttp://localhost:3001/api
- **å¥åº·æª¢æŸ¥**ï¼šhttp://localhost:3001/health

> **æ³¨æ„**ï¼šMakefile é è¨­ä½¿ç”¨ç«¯å£ 3001 ä»¥é¿å…èˆ‡å…¶ä»–æœå‹™è¡çªã€‚å¦‚éœ€ä¿®æ”¹ç«¯å£ï¼Œè«‹ç·¨è¼¯ Makefile ä¸­çš„ `PORT` è®Šæ•¸ã€‚

## é …ç›®æ¶æ§‹

é …ç›®æ¡ç”¨åˆ†å±¤æ¶æ§‹è¨­è¨ˆï¼š

- **domain**: åŒ…å«é ˜åŸŸæ¨¡å‹ã€å€¼å°è±¡ã€èšåˆå’Œäº‹ä»¶å®šç¾©
- **application**: åŒ…å«æ‡‰ç”¨æœå‹™å’Œå‘½ä»¤è™•ç†å™¨
- **infrastructure**: åŒ…å«åŸºç¤è¨­æ–½çµ„ä»¶ï¼Œå¦‚äº‹ä»¶å­˜å„²å’Œè®€æ¨¡å‹
- **interfaces**: åŒ…å«æ§åˆ¶å™¨ã€DTO å’Œé©—è­‰å™¨

## æ¶æ§‹è¨­è¨ˆæ±ºç­–

### äº‹ä»¶æºæ¨¡å¼ (Event Sourcing)

æœ¬å°ˆæ¡ˆæ¡ç”¨äº‹ä»¶æºæ¨¡å¼ä½œç‚ºæ ¸å¿ƒæ¶æ§‹ç­–ç•¥ï¼Œå…·æœ‰ä»¥ä¸‹å„ªå‹¢ï¼š

#### 1. å®Œæ•´çš„å¯©è¨ˆè»Œè·¡

- **ä¸å¯è®Šäº‹ä»¶æµ**ï¼šæ¯å€‹æ¥­å‹™æ“ä½œéƒ½ä»¥äº‹ä»¶å½¢å¼è¨˜éŒ„ï¼Œå½¢æˆå®Œæ•´çš„æ­·å²è»Œè·¡
- **æ™‚é–“æ—…è¡Œ**ï¼šå¯ä»¥é‡æ’­ä»»æ„æ™‚é–“é»çš„ç³»çµ±ç‹€æ…‹
- **åˆè¦è¦æ±‚**ï¼šæ»¿è¶³é‡‘èæ¥­å°äº¤æ˜“è¨˜éŒ„çš„åš´æ ¼è¦æ±‚

#### 2. é«˜æ€§èƒ½è®€å¯«åˆ†é›¢ (CQRS)

- **å‘½ä»¤ç«¯**ï¼šå°ˆæ³¨æ–¼æ¥­å‹™è¦å‰‡é©—è­‰å’Œäº‹ä»¶ç”¢ç”Ÿ
- **æŸ¥è©¢ç«¯**ï¼šé‡å°ç‰¹å®šç”¨ä¾‹å„ªåŒ–çš„è®€å–æ¨¡å‹
- **ç¨ç«‹æ“´å±•**ï¼šè®€å¯«æ“ä½œå¯ä»¥ç¨ç«‹å„ªåŒ–å’Œæ“´å±•

#### 3. æ¥­å‹™é‚è¼¯çš„ç´”ç²¹æ€§

```typescript
// èšåˆåªé—œæ³¨æ¥­å‹™è¦å‰‡ï¼Œä¸æ¶‰åŠåŸºç¤è¨­æ–½
class AccountAggregate {
  execute(command: DepositCommand): DomainEvent[] {
    // ç´”æ¥­å‹™é‚è¼¯é©—è­‰
    return [new MoneyDepositedEvent(...)];
  }
}
```

### ä½µç™¼æ§åˆ¶ç­–ç•¥

#### 1. æ¨‚è§€é– (Optimistic Locking)

```typescript
// åŸºæ–¼ç‰ˆæœ¬è™Ÿçš„ä½µç™¼æ§åˆ¶
append(aggregateId: string, expectedVersion: number, events: DomainEvent[]): void {
  const currentVersion = this.getCurrentVersion(aggregateId);
  if (currentVersion !== expectedVersion) {
    throw new ConcurrencyError('ç‰ˆæœ¬è¡çªï¼Œè«‹é‡è©¦');
  }
  // åŸå­æ€§è¿½åŠ äº‹ä»¶
}
```

#### 2. äº’æ–¥é–é˜²æ­»é– (Mutex with Deadlock Prevention)

```typescript
// å­—å…¸åºæ’åºé˜²æ­¢æ­»é–
async transfer(fromId: string, toId: string, amount: Money): Promise<void> {
  const sortedIds = [fromId, toId].sort();
  await this.mutexService.withLocks(sortedIds, async () => {
    // åŸå­æ€§è½‰å¸³æ“ä½œ
  });
}
```

#### 3. ä½µç™¼å®‰å…¨ä¿è­‰

- **å¸³æˆ¶é–“è½‰å¸³**ï¼šä½¿ç”¨æ’åºé–é¿å… Aâ†’B å’Œ Bâ†’A åŒæ™‚é€²è¡Œé€ æˆçš„æ­»é–
- **é¤˜é¡ä¸€è‡´æ€§**ï¼šé€éäº‹ä»¶é‡æ’­ç¢ºä¿æ•¸æ“šå®Œæ•´æ€§
- **å†ªç­‰æ€§**ï¼šæŠ•å½±å™¨æ”¯æ´é‡è¤‡äº‹ä»¶è™•ç†

### é ˜åŸŸé©…å‹•è¨­è¨ˆ (DDD)

#### 1. å…­è§’æ¶æ§‹ (Hexagonal Architecture)

```
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     Interfaces          â”‚  â† REST API, GraphQL
  â”‚   (Ports & Adapters)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚    Application          â”‚  â† Use Cases, Commands
  â”‚   (Orchestration)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚      Domain             â”‚  â† Business Logic (Pure)
  â”‚   (Core Business)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Infrastructure        â”‚  â† Database, Event Bus
  â”‚   (Technical Concerns)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. èšåˆè¨­è¨ˆåŸå‰‡

- **ä¸€è‡´æ€§é‚Šç•Œ**ï¼šå–®ä¸€èšåˆå…§ä¿è­‰å¼·ä¸€è‡´æ€§
- **æ¥­å‹™ä¸è®Šé‡**ï¼šé¤˜é¡ä¸èƒ½ç‚ºè² æ•¸ç­‰è¦å‰‡åœ¨èšåˆå…§åŸ·è¡Œ
- **å°èšåˆ**ï¼šå–®ä¸€å¸³æˆ¶ç‚ºä¸€å€‹èšåˆï¼Œé¿å…è·¨èšåˆäº‹å‹™

## äº‹ä»¶é‡æ”¾åŠŸèƒ½

### ä½¿ç”¨æ–¹å¼

```bash
# é‡æ”¾é è¨­æ¸¬è©¦æ•¸æ“š
npm run replay

# é‡æ”¾æŒ‡å®šäº‹ä»¶æ–‡ä»¶
npm run replay path/to/events.json

# ä½¿ç”¨ ts-node ç›´æ¥åŸ·è¡Œ
npx ts-node scripts/replay-events.ts test-data/events.json
```

### é‡æ”¾è…³æœ¬åŠŸèƒ½

1. **äº‹ä»¶è¼‰å…¥**ï¼šå¾ JSON æ–‡ä»¶è®€å–åºåˆ—åŒ–äº‹ä»¶
2. **é¤˜é¡è¨ˆç®—**ï¼šæŒ‰ç…§äº‹ä»¶æ™‚é–“é †åºé‡å»ºå¸³æˆ¶ç‹€æ…‹
3. **ä¸€è‡´æ€§é©—è­‰**ï¼šæª¢æŸ¥ç¸½é¤˜é¡å®ˆæ†å®šå¾‹
4. **è©³ç´°å ±å‘Š**ï¼šé¡¯ç¤ºæ¯å€‹å¸³æˆ¶çš„æœ€çµ‚é¤˜é¡å’Œäº‹ä»¶æ•¸é‡

### ç¤ºä¾‹è¼¸å‡º

```
ğŸ¬ é–‹å§‹äº‹ä»¶é‡æ”¾...

ğŸ“„ è¼‰å…¥ 5 å€‹äº‹ä»¶
ğŸ‘¥ ç™¼ç¾ 2 å€‹å¸³æˆ¶

ğŸ¦ å¸³æˆ¶ acc-001... | é¤˜é¡: $900 | äº‹ä»¶æ•¸: 3
ğŸ¦ å¸³æˆ¶ acc-002... | é¤˜é¡: $700 | äº‹ä»¶æ•¸: 2

============================================================
ğŸ’° ç¸½é¤˜é¡: $1500
ğŸ“Š ç¸½äº‹ä»¶æ•¸: 5
âœ… é‡æ”¾å®Œæˆï¼æ‰€æœ‰å¸³æˆ¶é¤˜é¡å·²é©—è­‰ã€‚
âœ… é¤˜é¡å®ˆæ†é©—è­‰é€šé
```

## æ¸¬è©¦è¦†è“‹ç‡

[![Coverage Status](https://img.shields.io/badge/coverage-95%25-brightgreen.svg)](coverage)

æœ¬å°ˆæ¡ˆåŒ…å«å®Œæ•´çš„æ¸¬è©¦å¥—ä»¶ï¼š

- **å–®å…ƒæ¸¬è©¦**ï¼š62 å€‹æ¸¬è©¦ï¼Œè¦†è“‹æ‰€æœ‰æ ¸å¿ƒæ¥­å‹™é‚è¼¯
- **ç«¯å°ç«¯æ¸¬è©¦**ï¼š12 å€‹æ¸¬è©¦ï¼Œè¦†è“‹å®Œæ•´çš„ API å·¥ä½œæµç¨‹
- **ä½µç™¼æ¸¬è©¦**ï¼š100 å€‹ä¸¦ç™¼è½‰å¸³æ“ä½œçš„å£“åŠ›æ¸¬è©¦
- **é‡æ’­æ¸¬è©¦**ï¼šäº‹ä»¶é‡æ’­åŠŸèƒ½çš„å®Œæ•´æ€§é©—è­‰

## æœªä¾†æ¼”é€²è·¯å¾‘

### éšæ®µä¸€ï¼šç”Ÿç”¢å°±ç·’ (Production Ready)

#### 1. PostgreSQL äº‹ä»¶å­˜å„²

```sql
-- äº‹ä»¶å­˜å„²è¡¨è¨­è¨ˆ
CREATE TABLE event_store (
  sequence_number BIGSERIAL PRIMARY KEY,
  aggregate_id UUID NOT NULL,
  event_type VARCHAR(100) NOT NULL,
  event_version INTEGER NOT NULL,
  event_data JSONB NOT NULL,
  metadata JSONB,
  occurred_at TIMESTAMP WITH TIME ZONE NOT NULL,
  UNIQUE(aggregate_id, event_version)
);

-- æ•ˆèƒ½ç´¢å¼•
CREATE INDEX idx_event_store_aggregate_id ON event_store(aggregate_id);
CREATE INDEX idx_event_store_occurred_at ON event_store(occurred_at);
```

#### 2. å¿«ç…§æ©Ÿåˆ¶ (Snapshots)

```typescript
interface AggregateSnapshot {
  aggregateId: string;
  aggregateType: string;
  version: number;
  data: any;
  createdAt: Date;
}

// æ¯ 100 å€‹äº‹ä»¶å»ºç«‹ä¸€æ¬¡å¿«ç…§
class SnapshotStore {
  save(snapshot: AggregateSnapshot): Promise<void>;
  load(aggregateId: string): Promise<AggregateSnapshot | null>;
}
```

#### 3. äº‹ä»¶ç‰ˆæœ¬æ§åˆ¶

```typescript
// æ”¯æ´äº‹ä»¶çµæ§‹æ¼”é€²
interface EventMigration {
  fromVersion: number;
  toVersion: number;
  migrate(event: any): any;
}
```

### éšæ®µäºŒï¼šä¼æ¥­ç´šæ“´å±• (Enterprise Scale)

#### 1. è¨Šæ¯ä½‡åˆ—æ•´åˆ

```typescript
// Apache Kafka æˆ– RabbitMQ æ•´åˆ
interface EventPublisher {
  publish(event: DomainEvent): Promise<void>;
  publishBatch(events: DomainEvent[]): Promise<void>;
}

// æ”¯æ´è·¨æœå‹™äº‹ä»¶é€šçŸ¥
@EventHandler('MoneyTransferredEvent')
class NotificationService {
  async handle(event: MoneyTransferredEvent): Promise<void> {
    // ç™¼é€é€šçŸ¥ã€æ›´æ–°å¤–éƒ¨ç³»çµ±ç­‰
  }
}
```

#### 2. åˆ†æ•£å¼é–

```typescript
// Redis åˆ†æ•£å¼é–æ›¿ä»£ in-memory mutex
class DistributedMutexService {
  async acquireLock(keys: string[], ttl: number): Promise<Lock>;
  async releaseLock(lock: Lock): Promise<void>;
}
```

#### 3. è®€å–æ¨¡å‹åˆ†ç‰‡

```typescript
// æŒ‰ç…§å¸³æˆ¶ ID é€²è¡Œåˆ†ç‰‡
class ShardedBalanceReadModel {
  private getShardKey(accountId: string): string {
    return accountId.slice(-2); // æœ€å¾Œå…©ä½ä½œç‚ºåˆ†ç‰‡éµ
  }
}
```

### éšæ®µä¸‰ï¼šé›²åŸç”Ÿæ¶æ§‹ (Cloud Native)

#### 1. å¾®æœå‹™æ‹†åˆ†

- **å¸³æˆ¶æœå‹™**ï¼šå¸³æˆ¶å‰µå»ºå’ŒåŸºæœ¬æ“ä½œ
- **äº¤æ˜“æœå‹™**ï¼šè½‰å¸³å’Œäº¤æ˜“è™•ç†
- **æŸ¥è©¢æœå‹™**ï¼šé¤˜é¡å’Œæ­·å²è¨˜éŒ„æŸ¥è©¢
- **é€šçŸ¥æœå‹™**ï¼šäº¤æ˜“é€šçŸ¥å’Œå ±å‘Š

#### 2. å®¹å™¨åŒ–å’Œç·¨æ’

```yaml
# Kubernetes Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: banking-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: banking-api
  template:
    spec:
      containers:
        - name: banking-api
          image: banking-api:latest
          env:
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: database-secret
                  key: url
```

#### 3. å¯è§€æ¸¬æ€§

- **åˆ†æ•£å¼è¿½è¹¤**ï¼šJaeger æˆ– Zipkin
- **æŒ‡æ¨™ç›£æ§**ï¼šPrometheus + Grafana
- **æ—¥èªŒèšåˆ**ï¼šELK Stack
- **å¥åº·æª¢æŸ¥**ï¼šKubernetes Probes

### å¯¦æ–½å»ºè­°

1. **æ¼¸é€²å¼é·ç§»**ï¼šå…ˆå°‡ InMemoryEventStore æ›¿æ›ç‚º PostgreSQL
2. **å‘å¾Œç›¸å®¹**ï¼šä¿æŒ API æ¥å£ä¸è®Šï¼Œå…§éƒ¨å¯¦ä½œé€æ­¥æ›¿æ›
3. **æ¸¬è©¦é©…å‹•**ï¼šæ¯å€‹éšæ®µéƒ½è¦æœ‰å°æ‡‰çš„æ¸¬è©¦è¦†è“‹
4. **ç›£æ§å…ˆè¡Œ**ï¼šåœ¨é‡æ§‹å‰å»ºç«‹å®Œå–„çš„ç›£æ§é«”ç³»
